<!DOCTYPE html>
<html>
  <head>
    <title>go on, spend!</title>
    <link rel="stylesheet" href="/css/normalize.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  </head>

  <body>
    <script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
    <!-- quick entry button handler -->
    <script>
      function qe(evt) {
        let amount = document.getElementById('amount')
        amount.value = ((amount.value == "" ? 0 : parseFloat(amount.value)) + parseFloat(evt.target.id)).toFixed(2)
      }
    </script>

    <!-- submit error handlers -->
    <script>
      function networkErrorHandler(event) {
        let ediv = document.getElementById('error')
        ediv.hidden = false
        ediv.append(event.detail.xhr.statusText, document.createElement("br"), event.detail.xhr.responseText)
      }
      htmx.on("htmx:responseError", networkErrorHandler)
      htmx.on("htmx:sendError", networkErrorHandler)
      htmx.on("htmx:beforeSend", (event) => {
        let ediv = document.getElementById('error')
        ediv.hidden = true
        while (ediv.firstChild) { ediv.removeChild(ediv.firstChild) }
      })
    </script>

    <div class="container">
      <form>
        <div class="row">
          <label for="category">Category</label>
          <select id="category" name="category">
            {{ range .Categories }}
            <option value="{{.}}">{{.}}</option>
            {{ end }}
          </select>
        </div>
        <div class="row">
          <label for="description">Description</label>
          <input type="text" id="description" name="description" />
        </div>
        <div class="row">
          <label for="amount">Amount</label>
          <input type="number" step="0.10" min="0" id="amount" name="amount" />
        </div>
        <div class="row">
          <div id="error" style="color: red" hidden="true" class="row"></div>
          <button class="button-primary" hx-post="/submit" hx-target="div.container" hx-disabled-elt="this">Submit</button>
        </div>
      </form>
      <div class="row">
        <button class="four columns" onclick="qe(event)" id="10">+10</button>
        <button class="four columns" onclick="qe(event)" id="5">+5</button>
        <button class="four columns" onclick="qe(event)" id="1">+1</button>
      </div>
      <div class="row">
        <button class="four columns" onclick="qe(event)" id="0.10">+0.10</button>
        <button class="four columns" onclick="qe(event)" id="0.50">+0.50</button>
        <button class="four columns" onclick="qe(event)" id="0.01">+0.01</button>
      </div>
    </div>
    <footer class="u-full-width u-max-full-width" style="text-align:center; font-size:0.8em; color:gray; margin-top:20px;">
      Logged in as: {{.Email}}
    </footer>
  </body>
</html>
